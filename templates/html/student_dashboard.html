{% load static %}
<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<html lang="ar" dir="rtl">
<style>
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    /* Ù„Ù…Ø§ ÙŠØªÙØ¹Ù„ */
    input:checked+.slider {
        background-color: #2196F3;
        /* Ø£Ø²Ø±Ù‚ Ø¬Ù…ÙŠÙ„ */
    }

    input:checked+.slider:before {
        transform: translateX(26px);
    }


    .popup-notif {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #2c3e50;
        color: #fff;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        z-index: 9999;
        animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    [x-cloak] {
        display: none !important;
    }
</style>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ - Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.0.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>

    <!-- ECharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}">
</head>

<body class="bg-gray-50">
    <header class="fixed w-full top-0 z-50" style="background-color: #1a3a30; border-bottom: 2px solid #c9b67a;">
        <div class="container mx-auto px-3">
            <nav class="flex items-center justify-between py-1">
                <!-- Logo -->
                <a href="{% url 'inbox' %}" class="flex items-center space-x-2 no-underline">
                    <img src="{% static 'images/logo.png' %}" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØµØ©" class="h-10 ml-3">
                    <span class="font-bold text-white text-lg font-['Tajawal']">Ø¨Ø§Ù„Ù‚Ø±Ø¢Ù† Ù†Ø­ÙŠØ§</span>
                </a>


                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-3 space-x-reverse">
                    <!-- Update these links in your navigation -->
                    <a href="{% url 'inbox' %}"
                        class="text-white hover:text-gray-200 text-sm font-medium px-2 py-1">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="{% url 'about_me' %}"
                        class="text-white hover:text-gray-200 text-sm font-medium px-2 py-1">Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a>
                    <a href="{% url 'contact' %}"
                        class="text-white hover:text-gray-200 text-sm font-medium px-2 py-1">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                    <a href="{% url 'message_list' %}" class="relative ml-4">
                        <i class="ri-notification-3-line text-white"></i>
                        {% if unread_messages_count > 0 %}
                        <span
                            class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full h-4 w-4 flex items-center justify-center">
                            {{ unread_messages_count }}
                        </span>
                        {% endif %}


                    </a>




                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full overflow-hidden ml-2">
                            <img id="navbar-image"
                                src="{% if student_data.image %}{{ student_data.image.url }}{% else %}https://via.placeholder.com/100{% endif %}"
                                alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full h-full object-cover">
                        </div>
                        <span class="text-white text-sm font-medium mr-1">
                            {{ student_data.name|default:'Ù…Ø±Ø­Ø¨Ø§Ù‹' }}
                        </span>
                    </div>
                </div>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
            <button id="menu-toggle" class="md:hidden text-white p-2 focus:outline-none">
                <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© 3 Ø´Ø±Ø· -->
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
        </nav>
        </div>

        <!-- Mobile menu -->
        <div class="md:hidden hidden bg-green-800" id="mobile-menu">
            <div class="px-2 py-1 space-y-0">
                <a href="#" class="block px-3 py-1.5 text-sm text-white hover:bg-green-700">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="#" class="block px-3 py-1.5 text-sm text-white hover:bg-green-700">Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a>
                <a href="#" class="block px-3 py-1.5 text-sm text-white hover:bg-green-700">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                <div class="pt-2 border-t border-green-700">
                    <div class="flex items-center px-3 py-1.5">
                        <div class="w-7 h-7 rounded-full overflow-hidden ml-2">
                            <img src="{% if student_data.image %}{{ student_data.image.url }}{% else %}https://via.placeholder.com/100{% endif %}"
                                alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full h-full object-cover">
                        </div>
                        <span class="text-white text-sm">
                            {{ student_data.name|default:'Ø­Ø³Ø§Ø¨ÙŠ' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <!-- Add padding to the top of the main content to account for fixed header -->
    <main class="pt-16">
        <!-- Your page content here -->
    </main>

    <script>
        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function () {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });
    </script>
    <!-- Main Content -->
<main class="container mx-auto px-4 mt-20 pb-12">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Sidebar -->
        <aside class="lg:col-span-1 space-y-6">
            <div class="card card-hover text-center p-6" id="student-card">
                <div class="bg-white p-6 rounded-lg shadow text-center">
                    <img id="main-image"
                        src="{% if student_data.image %}{{ student_data.image.url }}{% else %}https://via.placeholder.com/100{% endif %}"
                        alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-24 h-24 rounded-full object-cover mx-auto">

                    <h2 id="main-name" class="text-xl font-bold text-center mb-1">
                        {{ student_data.name|default:"-" }}
                    </h2>

                    {% if student_data.age %}
                        <span class="text-gray-600">Ø§Ù„Ø¹Ù…Ø±:</span>
                        <span id="main-age" class="text-gray-600 text-center mb-1">
                            {{ student_data.age }}
                        </span>
                    {% endif %}

                    {% if student_data.city %}
                        <span class="text-gray-600">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</span>
                        <span id="main-city" class="text-gray-600 text-center mb-4">
                            {{ student_data.city }}
                        </span>
                    {% endif %}

                    <div id="main-extra">
                        {% if student_data.level or student_data.current_surah or student_data.current_juz %}
                        <div class="w-full border-t border-gray-200 my-4"></div>
                        <div class="w-full space-y-2">
                            {% if student_data.level %}
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                <span class="font-medium text-primary text-right" id="main-level">
                                    {{ student_data.level }}
                                </span>
                            </div>
                            {% endif %}
                            {% if student_data.current_surah %}
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                                <span class="font-medium text-primary text-right" id="main-surah">
                                    {{ student_data.current_surah }}
                                </span>
                            </div>
                            {% endif %}
                            {% if student_data.current_juz %}
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                <span class="font-medium text-primary text-right" id="main-juz">
                                    {{ student_data.current_juz }}
                                </span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
                    <div x-data="{ open: false }">
                        <!-- Ø§Ù„Ø²Ø± -->
                        <a href="#" @click.prevent="open = true"
                            class="mt-4 inline-block bg-primary text-white px-4 py-2 rounded shadow hover:bg-primary/80">
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </a>

                        <!-- Ø§Ù„ÙÙˆØ±Ù…Ø© (Modal) -->
                        <div x-show="open" x-cloak
                            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                            x-transition>
                            <div class="bg-white p-6 rounded-lg shadow-lg w-96 relative">
                                <h3 class="text-lg font-bold mb-4">Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                                <form id="profile-form" method="POST" action="{% url 'update_profile_data' %}"
                                    enctype="multipart/form-data">
                                    {% csrf_token %}
                                    
                                    <label class="block mb-2">Ø§Ù„ØµÙˆØ±Ø©:</label>
                                    <div class="flex items-center gap-4 mb-3">
                                        <img id="image-preview"
                                            src="{% if student_data.image %}{{ student_data.image.url }}{% else %}https://via.placeholder.com/100{% endif %}"
                                            alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨" class="w-20 h-20 object-cover rounded-full border">
                                        <input type="file" name="image" accept="image/*"
                                            class="border rounded p-2 w-full" onchange="previewImage(event)">
                                    </div>

                                    <label class="block mb-2">Ø§Ù„Ø§Ø³Ù…:</label>
                                    <input type="text" name="name" id="input-name"
                                        value="{{ student_data.name|default_if_none:'' }}"
                                        class="w-full border rounded p-2 mb-3">

                                    <label class="block mb-2">Ø§Ù„Ø¹Ù…Ø±:</label>
                                    <input type="number" name="age" id="input-age"
                                        value="{{ student_data.age|default_if_none:'' }}" min="1"
                                        class="w-full border rounded p-2 mb-3">

                                    <label class="block mb-2">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                                    <input type="text" name="city" id="input-city"
                                        value="{{ student_data.city|default_if_none:'' }}"
                                        class="w-full border rounded p-2 mb-3">

                                    <label class="block mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                                    <input type="text" name="level" id="input-level"
                                        value="{{ student_data.level|default_if_none:'' }}"
                                        class="w-full border rounded p-2 mb-3">

                                    <label class="block mb-2">Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                                    <input type="text" name="current_surah" id="input-surah"
                                        value="{{ student_data.current_surah|default_if_none:'' }}"
                                        class="w-full border rounded p-2 mb-3">

                                    <label class="block mb-2">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                                    <input type="number" name="current_juz" id="input-juz"
                                        value="{{ student_data.current_juz|default_if_none:'' }}" min="1" max="30"
                                        class="w-full border rounded p-2 mb-3">

                                    <div class="flex justify-end gap-2 mt-4">
                                        <button type="button" @click="open = false"
                                            class="px-4 py-2 border rounded-lg">
                                            Ø¥Ù„ØºØ§Ø¡
                                        </button>
                                        <button type="submit" @click="open = false" id="save-btn"
                                            class="px-4 py-2 bg-primary text-white rounded-lg shadow flex items-center gap-2 hover:bg-primary/80 transition">
                                            <span id="save-btn-text">ğŸ’¾ Ø­ÙØ¸</span>
                                            <span id="save-btn-loader"
                                                class="hidden animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"></span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            
                    <div id="alert-box"
                        class="fixed top-5 right-5 z-50 hidden bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg">
                    </div>

                    <!-- Ø§Ø³ÙƒØ±Ø¨Øª Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© -->
                    <script>
                        function previewImage(event) {
                            var reader = new FileReader();
                            reader.onload = function () {
                                var output = document.getElementById('image-preview');
                                output.src = reader.result;
                            };
                            if (event.target.files && event.target.files[0]) {
                                reader.readAsDataURL(event.target.files[0]);
                            }
                        }
                    </script>

                    <!-- AJAX ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø© -->
                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const form = document.getElementById('profile-form');
                            if (form) {
                                form.addEventListener('submit', function (e) {
                                    e.preventDefault();
                                    let formData = new FormData(form);

                                    fetch(form.action, {
                                        method: 'POST',
                                        headers: {
                                            'X-Requested-With': 'XMLHttpRequest'
                                        },
                                        body: formData
                                    })
                                        .then(response => response.json())
                                        .then(data => {
                                            if (data.success) {
                                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©
                                                if (data.image_url) {
                                                    document.getElementById('main-image').src = data.image_url;
                                                    document.getElementById('image-preview').src = data.image_url;
                                                }
                                                document.getElementById('main-name').textContent = data.name || '-';
                                                document.getElementById('main-age').textContent = data.age || '';
                                                document.getElementById('main-city').textContent = data.city || '';

                                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                                                let extraHtml = '';
                                                if (data.level || data.current_surah || data.current_juz) {
                                                    extraHtml += '<div class="w-full border-t border-gray-200 my-4"></div><div class="w-full space-y-2">';
                                                    if (data.level)
                                                        extraHtml += `<div class="flex justify-between"><span class="text-gray-600">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span><span class="font-medium text-primary text-right">${data.level}</span></div>`;
                                                    if (data.current_surah)
                                                        extraHtml += `<div class="flex justify-between"><span class="text-gray-600">Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span><span class="font-medium text-primary text-right">${data.current_surah}</span></div>`;
                                                    if (data.current_juz)
                                                        extraHtml += `<div class="flex justify-between"><span class="text-gray-600">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span><span class="font-medium text-primary text-right">${data.current_juz}</span></div>`;
                                                    extraHtml += '</div>';
                                                }
                                                document.getElementById('main-extra').innerHTML = extraHtml;

                                                // ğŸ”¥ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                                                let alertBox = document.getElementById("alert-box");
                                                alertBox.textContent = data.message || "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
                                                alertBox.classList.remove("hidden");
                                                setTimeout(() => {
                                                    alertBox.classList.add("hidden");
                                                }, 3000);
                                            } else if (data.errors) {
                                                let alertBox = document.getElementById("alert-box");
                                                alertBox.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + JSON.stringify(data.errors);
                                                alertBox.classList.remove("hidden");
                                                setTimeout(() => {
                                                    alertBox.classList.add("hidden");
                                                }, 3000);
                                            } else {
                                                let alertBox = document.getElementById("alert-box");
                                                alertBox.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹!";
                                                alertBox.classList.remove("hidden");
                                                setTimeout(() => {
                                                    alertBox.classList.add("hidden");
                                                }, 3000);
                                            }
                                        })

                                });
                            }
                        });

                    </script>

                    <!-- Alpine.js Ùˆ x-cloak CSS -->
                    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
                    <style>
                        [x-cloak] {
                            display: none !important;
                        }
                    </style>


                    </div>
            </aside>

            <!-- Main Content Area -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Progress Section -->
                <div class="card card-hover">
                    <h2 class="text-xl font-bold mb-6">ØªÙ‚Ø¯Ù…Ùƒ ÙÙŠ Ø§Ù„Ø­ÙØ¸</h2>
                    <div class="flex flex-col md:flex-row">
                        <!-- Progress Ring -->
                        <!-- Progress Ring -->
                        <div class="flex-1 flex justify-center mb-6 md:mb-0">
                            <div class="relative w-48 h-48">
                                <svg width="160" height="160" class="progress-ring">
                                    <!-- Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© -->
                                    <circle stroke="#e6e6e6" stroke-width="10" fill="transparent" r="70" cx="80"
                                        cy="80" />
                                    <!-- Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ØªÙ‚Ø¯Ù… -->
                                    <circle id="progressCircle" stroke="#2E7D32" stroke-width="10" fill="transparent"
                                        r="70" cx="80" cy="80"
                                        style="transform: rotate(-90deg); transform-origin: 50% 50%;" />
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="progressPercent" class="text-3xl font-bold text-primary">
                                        {{ student_data.progress|default:0 }}%
                                    </span>
                                    <span class="text-sm text-gray-600">Ù…Ù† Ø§Ù„Ù‡Ø¯Ù</span>
                                </div>
                            </div>
                        </div>

                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                // Ø¬Ù„Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ù…Ù† Ø§Ù„Ø¯Ø¬Ø§Ù†ØºÙˆ
                                var progress = parseFloat("{{ student_data.progress|default:0 }}");
                                progress = Math.max(0, Math.min(100, progress)); // ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ Ø¨ÙŠÙ† 0 Ùˆ 100

                                var circle = document.getElementById('progressCircle');
                                var radius = 70;
                                var circumference = 2 * Math.PI * radius;

                                circle.setAttribute('stroke-dasharray', circumference);
                                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø²Ø¡ ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„
                                var offset = circumference - (progress / 100) * circumference;
                                circle.setAttribute('stroke-dashoffset', offset);

                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
                                var percentText = document.getElementById('progressPercent');
                                if (percentText) {
                                    percentText.textContent = progress + "%";
                                }
                            });
                        </script>
                        <!-- Stats Cards -->
                        <div class="flex-1">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Saved Parts -->
                                <div class="bg-green-50 rounded-lg p-4 card-hover">
                                    <div class="flex items-center mb-2">
                                        <i class="ri-book-mark-line text-primary ml-2"></i>
                                        <h4 class="font-medium">Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h4>
                                    </div>
                                    <span class="text-3xl font-bold text-primary">
                                        {{ student_data.current_juz|default:0 }}
                                        <span class="text-sm text-gray-600 font-normal">Ù…Ù† 30 Ø¬Ø²Ø¡</span>
                                    </span>
                                </div>

                                <!-- Reviews -->
                                <div class="bg-blue-50 rounded-lg p-4 card-hover">
                                    <div class="flex items-center mb-2">
                                        <i class="ri-refresh-line text-blue-600 ml-2"></i>
                                        <h4 class="font-medium">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</h4>
                                    </div>
                                    <span class="text-3xl font-bold text-blue-600">
                                        {{ student_data.reviews|default:0 }}
                                        <span class="text-sm text-gray-600 font-normal">Ù…Ø±Ø§Ø¬Ø¹Ø© Ù†Ø§Ø¬Ø­Ø©</span>
                                    </span>
                                </div>

                                <!-- Attendance -->
                                <div class="bg-yellow-50 rounded-lg p-4 card-hover">
                                    <div class="flex items-center mb-2">
                                        <i class="ri-time-line text-yellow-600 ml-2"></i>
                                        <h4 class="font-medium">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</h4>
                                    </div>
                                    <span class="text-3xl font-bold text-yellow-600">
                                        {{ student_data.commitment|default:0 }}%
                                        <span class="text-sm text-gray-600 font-normal">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</span>
                                    </span>
                                </div>

                                <!-- Evaluation -->
                                <div class="bg-purple-50 rounded-lg p-4 card-hover">
                                    <div class="flex items-center mb-2">
                                        <i class="ri-award-line text-purple-600 ml-2"></i>
                                        <h4 class="font-medium">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h4>
                                    </div>
                                    <span class="text-3xl font-bold text-purple-600">
                                        {{ student_data.rating|default:0 }}
                                        <span class="text-sm text-gray-600 font-normal">Ù…Ù† 5</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-lg font-bold mb-4">ØªÙ‚Ø¯Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
                        <div id="weeklyLineChart" style="width: 100%; height: 300px;"></div>
                    </div>
                </div>
                <script>
                    const yLabels = ['Ø¶Ø¹ÙŠÙ', 'Ø¬ÙŠØ¯', 'Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§', 'Ù…Ù…ØªØ§Ø²', 'Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ù‹Ø§'];

                    async function initWeeklyLineChart(studentId) {
                        let data;
                        try {
                            const response = await fetch(`/weekly-progress/${studentId}/`);
                            data = await response.json();
                        } catch (e) {
                            data = null;
                        }

                        let days = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
                        let memorized = [];
                        let reviews = [];
                        if (
                            !data ||
                            !data.memorized ||
                            !data.reviews
                        ) {
                            memorized = Array(7).fill('Ø¶Ø¹ÙŠÙ');
                            reviews = Array(7).fill('Ø¶Ø¹ÙŠÙ');
                        } else {
                            days = data.days || days;
                            memorized = data.memorized;
                            reviews = data.reviews;
                        }

                        // Ø­ÙˆÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù†ØµÙŠØ© Ø¥Ù„Ù‰ index Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù„Ù‰ yAxis Ù…Ù† Ù†ÙˆØ¹ category
                        const memorizedIdx = memorized.map(v => yLabels.indexOf(v));
                        const reviewsIdx = reviews.map(v => yLabels.indexOf(v));

                        const chartDom = document.getElementById('weeklyLineChart');
                        const chart = echarts.init(chartDom);

                        const option = {
                            tooltip: {
                                trigger: 'axis',
                                formatter: function (params) {
                                    let res = params[0].axisValue + '<br>';
                                    params.forEach(function (item) {
                                        let label = item.seriesName;
                                        let idx = item.value;
                                        let rating = yLabels[idx];
                                        res += label + ':<br><b>' + rating + '</b><br>';
                                    });
                                    return res;
                                }
                            },
                            legend: { data: ['Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©', 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª'], right: 20 },
                            grid: { left: '5%', right: '5%', bottom: '5%', containLabel: true },
                            xAxis: { type: 'category', boundaryGap: false, data: days },
                            yAxis: {
                                type: 'category',
                                data: yLabels,
                                axisLabel: { formatter: value => value }
                            },
                            series: [
                                {
                                    name: 'Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
                                    type: 'line',
                                    smooth: true,
                                    data: memorizedIdx,
                                    itemStyle: { color: '#2563eb' },
                                    areaStyle: {},
                                    label: {
                                        show: true,
                                        position: 'right',
                                        formatter: function (params) {
                                            return yLabels[params.value];
                                        }
                                    }
                                },
                                {
                                    name: 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª',
                                    type: 'line',
                                    smooth: true,
                                    data: reviewsIdx,
                                    itemStyle: { color: '#10b981' },
                                    areaStyle: {},
                                    label: {
                                        show: true,
                                        position: 'right',
                                        formatter: function (params) {
                                            return yLabels[params.value];
                                        }
                                    }
                                }
                            ]
                        };

                        chart.setOption(option);
                        window.addEventListener('resize', chart.resize);
                    }

                    const studentId = "{{ student.id }}";
                    initWeeklyLineChart(studentId);
                </script>






                <!-- Messages Section -->
                <div class="card card-hover">
                    <h2 class="text-xl font-bold mb-6">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª</h2>
                    <div class="flex gap-2 mb-4">
                        <button id="show-upcoming"
                            class="tab-button bg-primary text-white px-4 py-2 rounded-md">Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
                        <button id="show-past"
                            class="tab-button bg-gray-100 text-gray-700 px-4 py-2 rounded-md">Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="table w-full" id="schedule-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                    <th>Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th>Ø§Ù„Ù…Ø¹Ù„Ù…</th>
                                    <th>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</th>
                                </tr>
                            </thead>
                            <tbody>
                                {# Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© #}
                                {% for item in lessons %}
                                {% if item.date >= today %}
                                <tr class="row-upcoming">
                                    <td>{{ item.title|default:item.content|default:'-' }}</td>
                                    <td>{{ item.date|default:'-' }}</td>
                                    <td>{{ item.time|default:'-' }}</td>
                                    <td>
                                        <div class="flex items-center">
                                            <img src="{{ item.teacher.image|default:'https://randomuser.me/api/portraits/men/1.jpg' }}"
                                                alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…" class="w-8 h-8 rounded-full ml-2">
                                            <span>{{ item.teacher.name|default:'-' }}</span>
                                        </div>
                                    </td>
                                    <td>
                                        {% if item.meeting_link %}
                                        <a href="{{ item.meeting_link }}" target="_blank"
                                            class="btn btn-sm bg-blue-500 text-white rounded px-3 py-1">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</a>
                                        {% elif item.record_link %}
                                        <a href="{{ item.record_link }}" target="_blank"
                                            class="btn btn-sm bg-gray-500 text-white rounded px-3 py-1">Ù…Ø´Ø§Ù‡Ø¯Ø©
                                            Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a>
                                        {% else %}
                                        <span class="text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø·</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                                {% empty %}
                                <tr class="row-upcoming">
                                    <td colspan="5" class="text-center text-gray-400 py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ØµØµ Ø£Ùˆ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª
                                        Ù‚Ø§Ø¯Ù…Ø©.</td>
                                </tr>
                                {% endfor %}

                                {# Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© #}
                                {% for item in lessons %}
                                {% if item.date < today %} <tr class="row-past" style="display: none;">
                                    <td>{{ item.title|default:item.content|default:'-' }}</td>
                                    <td>{{ item.date|default:'-' }}</td>
                                    <td>{{ item.time|default:'-' }}</td>
                                    <td>
                                        <div class="flex items-center">
                                            <img src="{{ item.teacher.image|default:'https://randomuser.me/api/portraits/men/1.jpg' }}"
                                                alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…" class="w-8 h-8 rounded-full ml-2">
                                            <span>{{ item.teacher.name|default:'-' }}</span>
                                        </div>
                                    </td>
                                    <td>
                                        {% if item.meeting_link %}
                                        <a href="{{ item.meeting_link }}" target="_blank"
                                            class="btn btn-sm bg-blue-500 text-white rounded px-3 py-1">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</a>
                                        {% elif item.record_link %}
                                        <a href="{{ item.record_link }}" target="_blank"
                                            class="btn btn-sm bg-gray-500 text-white rounded px-3 py-1">Ù…Ø´Ø§Ù‡Ø¯Ø©
                                            Ø§Ù„ØªØ³Ø¬ÙŠÙ„</a>
                                        {% else %}
                                        <span class="text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø·</span>
                                        {% endif %}
                                    </td>
                                    </tr>
                                    {% endif %}
                                    {% empty %}
                                    <tr class="row-past" style="display: none;">
                                        <td colspan="5" class="text-center text-gray-400 py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ØµØµ Ø£Ùˆ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª
                                            Ø³Ø§Ø¨Ù‚Ø©.</td>
                                    </tr>
                                    {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <script>
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø©
                    document.addEventListener('DOMContentLoaded', function () {
                        const btnUpcoming = document.getElementById('show-upcoming');
                        const btnPast = document.getElementById('show-past');
                        const rowsUpcoming = document.querySelectorAll('.row-upcoming');
                        const rowsPast = document.querySelectorAll('.row-past');

                        btnUpcoming.addEventListener('click', function () {
                            btnUpcoming.classList.add('bg-primary', 'text-white');
                            btnUpcoming.classList.remove('bg-gray-100', 'text-gray-700');
                            btnPast.classList.remove('bg-primary', 'text-white');
                            btnPast.classList.add('bg-gray-100', 'text-gray-700');
                            rowsUpcoming.forEach(row => row.style.display = '');
                            rowsPast.forEach(row => row.style.display = 'none');
                        });

                        btnPast.addEventListener('click', function () {
                            btnPast.classList.add('bg-primary', 'text-white');
                            btnPast.classList.remove('bg-gray-100', 'text-gray-700');
                            btnUpcoming.classList.remove('bg-primary', 'text-white');
                            btnUpcoming.classList.add('bg-gray-100', 'text-gray-700');
                            rowsUpcoming.forEach(row => row.style.display = 'none');
                            rowsPast.forEach(row => row.style.display = '');
                        });

                        // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙÙ‚Ø·
                        rowsUpcoming.forEach(row => row.style.display = '');
                        rowsPast.forEach(row => row.style.display = 'none');
                    });
                </script>
                <!-- Evaluation Section -->
                <div class="card card-hover">
                    <h2 class="text-xl font-bold mb-6">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h2>

                    {% if evaluations %}
                    {% with evaluation=evaluations.0 %}
                    <div class="bg-gray-50 rounded-lg p-6 mb-6">
                        <div class="flex items-start">
                            <img src="{{ evaluation.teacher_img|default:'https://randomuser.me/api/portraits/men/1.jpg' }}"
                                alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…" class="w-12 h-12 rounded-full ml-4">
                            <div>
                                <div class="flex items-center mb-2">
                                    <h4 class="font-medium">{{ evaluation.teacher|default:'-' }}</h4>
                                    <span class="mx-2 text-gray-400">â€¢</span>
                                    <span class="text-gray-600 text-sm">{{ evaluation.date|default:'-' }}</span>
                                </div>
                                <div class="flex mb-3">
                                    {% for i in "12345" %}
                                    <i
                                        class="ri-star-fill {% if forloop.counter <= evaluation.stars|default:0 %}text-yellow-500{% else %}text-gray-300{% endif %} ml-1"></i>
                                    {% endfor %}
                                </div>
                                <p class="text-gray-700">{{ evaluation.comment|default:'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚.' }}</p>
                            </div>
                        </div>

                        {% if evaluation.details %}
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h5 class="font-medium mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {% for section in evaluation.details %}
                                <div>
                                    {% for item in section %}
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-gray-600">{{ item.label }}</span>
                                        <div class="flex">
                                            {% for j in "12345" %}
                                            <i
                                                class="ri-star-fill text-sm {% if forloop.counter <= item.stars %}text-yellow-500{% else %}text-gray-300{% endif %} ml-1"></i>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endwith %}
                    {% else %}
                    <div class="text-center text-gray-400 py-8">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯.</div>
                    {% endif %}

                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-medium mb-4">Ø®Ø·Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>




                        {% for plan in plans %}
                        <div class="plan-card"
                            style="text-align: right; margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 10px; background: #f9f9f9;">


                            <!-- Ø§Ù„ÙˆØµÙ -->
                            <p style="margin: 5px 0;">{{ plan.title }}</p>
                            <p style="margin: 5px 0;">{{ plan.description }}</p>

                            <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                            <p style="margin: 5px 0;">Ø§Ù„ÙŠÙˆÙ…: {{ plan.day }}</p>
                            <p style="margin: 5px 0;">Ø§Ù„Ø³ÙˆØ±Ø©: {{ plan.surah }}</p>
                            <p style="margin: 5px 0;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª: {{ plan.ayat_count }}</p>

                            <!-- Ø²Ø± Ø§Ù„ØªØ°ÙƒÙŠØ± -->
                            <div style="display: flex; align-items: center; margin-top: 10px;">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="reminder-toggle" data-id="{{ plan.id }}" {% if plan.reminder_enabled %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                                <span style="margin-right: 10px;">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                            </div>
                            <div style="display: flex; align-items: center; margin-top: 10px;">
                                <label class="toggle-switch">
                                    <input type="checkbox" class="completed-toggle" data-id="{{ plan.id }}" {% if plan.is_completed %}checked{% endif %}>
                                    <span class="slider"></span>
                                </label>
                                <span style="margin-right: 10px;">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø·Ø© ÙƒÙ…ÙƒØªÙ…Ù„Ø©</span>
                            </div>
                        </div>
                        {% empty %}
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø· Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                        {% endfor %}

                    </div>
                </div>
          
        
        <script>
            function showNotification(title, message) {
                // Ù†Ø¹Ù…Ù„ Ø¹Ù†ØµØ± popup
                let notif = document.createElement("div");
                notif.className = "popup-notif";
                notif.innerHTML = `<strong>${title}</strong><br>${message}`;

                // Ù†Ø¶ÙŠÙÙ‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
                document.body.appendChild(notif);

                // ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => {
                    notif.remove();
                }, 5000);
            }
            function showNotification(title, message) {
                Swal.fire({
                    title: title,
                    text: message,
                    icon: 'info',
                    allowOutsideClick: false,  // Ù…Ø§ ÙŠØªÙ‚ÙÙ„Ø´ Ù„Ùˆ Ø¶ØºØ· Ø¨Ø±Ø§
                    showConfirmButton: true,   // Ø²Ø±Ø§Ø± Ù…ÙˆØ§ÙÙ‚
                    confirmButtonText: "Ø¥ØºÙ„Ø§Ù‚"
                });
            }

            // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù†Ø¬ÙŠØ¨ Ø¢Ø®Ø± Ø¥Ø´Ø¹Ø§Ø±
            setInterval(() => {
                fetch("/notifications/latest/")
                    .then(response => response.json())
                    .then(data => {
                        if (data.title) {
                            showNotification(data.title, data.message);
                        }
                    });
            }, 60000); // 60000ms = Ø¯Ù‚ÙŠÙ‚Ø©

            document.addEventListener("DOMContentLoaded", function () {
                document.querySelectorAll(".reminder-toggle").forEach(function (toggle) {
                    toggle.addEventListener("change", function () {
                        let planId = this.getAttribute("data-id");
                        let isChecked = this.checked;  // âœ… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

                        fetch(`/toggle-reminder/${planId}/`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "X-CSRFToken": "{{ csrf_token }}",
                            },
                            body: JSON.stringify({ reminder_enabled: isChecked })  // Ù†Ø¨Ø¹Øª Ø§Ù„Ù‚ÙŠÙ…Ø©
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    console.log("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙƒÙŠØ±:", data.reminder_enabled);
                                } else {
                                    alert("Ø®Ø·Ø£: " + data.error);
                                }
                            });
                    });
                });
            });

            document.addEventListener("DOMContentLoaded", function () {
                // ØªÙØ¹ÙŠÙ„ / ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±
                document.querySelectorAll(".reminder-toggle").forEach(function (toggle) {
                    toggle.addEventListener("change", function () {
                        let planId = this.getAttribute("data-id");
                        let isChecked = this.checked;

                        fetch(`/toggle-reminder/${planId}/`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "X-CSRFToken": "{{ csrf_token }}",
                            },
                            body: JSON.stringify({ reminder_enabled: isChecked })
                        });
                    });
                });

                // âœ… ØªÙØ¹ÙŠÙ„ / ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„
                document.querySelectorAll(".completed-toggle").forEach(function (toggle) {
                    toggle.addEventListener("change", function () {
                        let planId = this.getAttribute("data-id");
                        let isChecked = this.checked;

                        fetch(`/toggle-completed/${planId}/`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "X-CSRFToken": "{{ csrf_token }}",
                            },
                            body: JSON.stringify({ is_completed: isChecked })
                        });
                    });
                });
            });
        </script>
        <!-- Subscription Status -->
        <div class="card card-hover">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6">
                <h2 class="text-xl font-bold">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h2>
                <div class="flex items-center mt-2 md:mt-0">
                    <span class="text-gray-600 ml-2">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                    <span class="status-badge status-active">Ù†Ø´Ø·</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Subscription Details -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold mb-4">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                    {% if subscription %}
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</span>
                            <span class="font-medium text-primary">{{ subscription.type|default:'Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ' }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</span>
                            <span>{{ subscription.start_date|default:'01/01/2024' }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</span>
                            <span>{{ subscription.end_date|default:'31/12/2024' }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                            <span
                                class="{% if subscription.is_active %}text-green-600{% else %}text-gray-600{% endif %}">
                                {{ subscription.display_status }}
                            </span>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <p class="text-gray-400 mb-2">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§Ùƒ.</p>
                        <a href="{% url 'inbox' %}"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                            Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø¢Ù†
                        </a>
                    </div>
                    {% endif %}
                </div>

                <!-- Subscription Features -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-bold mb-4">Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                    <ul class="space-y-3">
                        <li class="flex items-center">
                            <i class="ri-checkbox-circle-fill text-primary ml-2"></i>
                            <span>Ø­ØµØµ Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</span>
                        </li>
                        
                        <li class="flex items-center">
                            <i class="ri-checkbox-circle-fill text-primary ml-2"></i>
                            <span>Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…</span>
                        </li>
                        <li class="flex items-center">
                            <i class="ri-checkbox-circle-fill text-primary ml-2"></i>
                            <span>ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙ„Ø§ÙˆØ©</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="bg-gray-50 rounded-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                    <button class="text-primary hover:underline text-sm">ØªØµØ¯ÙŠØ± Ø§Ù„Ø³Ø¬Ù„</button>
                </div>


                <!-- Ø¢Ø®Ø± Ø§Ø´ØªØ±Ø§Ùƒ -->
                <div class="bg-gray-50 rounded-lg p-6 mt-6">
                    <div class="flex justify-between items-center cursor-pointer" onclick="document.getElementById('all-subscriptions').classList.toggle('hidden'); 
                      this.querySelector('svg').classList.toggle('rotate-180');">
                        <h3 class="text-lg font-bold">ğŸ“Œ Ø¢Ø®Ø± Ø§Ø´ØªØ±Ø§Ùƒ</h3>
                        <!-- Ø§Ù„Ø³Ù‡Ù… -->
                        <svg class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>

                    {% if latest_subscription %}
                    <div class="p-4 border rounded-lg bg-white shadow flex flex-wrap gap-6 mt-4">
                        <p><strong>Ø§Ù„Ø®Ø·Ø©:</strong> {{ latest_subscription.plan.name }}</p>
                        <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> {{ latest_subscription.price }} Ø¬Ù†ÙŠÙ‡</p>
                        <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> {{ latest_subscription.display_status }}</p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> {{ latest_subscription.start_date|date:"Y-m-d" }}</p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> {{ latest_subscription.end_date|date:"Y-m-d" }}</p>
                        <p><strong>Ø§Ù„Ø¥ÙŠØµØ§Ù„:</strong>
                            {% if latest_subscription.payment_image %}
                            <a href="{{ latest_subscription.payment_image.url }}" target="_blank"
                                class="text-primary hover:underline">
                                Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„
                            </a>
                            <!-- ØµÙˆØ±Ø© Ù…ØµØºØ±Ø© -->
                            <img src="{{ latest_subscription.payment_image.url }}" alt="Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹"
                                class="w-20 h-20 object-cover rounded border mt-2">
                            {% else %}
                            Ù„Ø§ ÙŠÙˆØ¬Ø¯
                            {% endif %}
                        </p>
                    </div>
                    {% else %}
                    <p class="text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¨Ø¹Ø¯.</p>
                    {% endif %}

                    <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
                    <div id="all-subscriptions" class="hidden mt-6 space-y-4">
                        {% for sub in subscriptions %}
                        {% if sub.id != latest_subscription.id %}
                        <div class="p-4 border rounded-lg bg-white shadow flex flex-wrap gap-6">
                            <p><strong>Ø§Ù„Ø®Ø·Ø©:</strong> {{ sub.plan.name }}</p>
                            <p><strong>Ø§Ù„Ù…Ø¨Ù„Øº:</strong> {{ sub.price }} Ø¬Ù†ÙŠÙ‡</p>
                            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> {{ sub.display_status }}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> {{ sub.start_date|date:"Y-m-d" }}</p>
                            <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> {{ sub.end_date|date:"Y-m-d" }}</p>
                            <p><strong>Ø§Ù„Ø¥ÙŠØµØ§Ù„:</strong>
                                {% if sub.payment_image %}
                                <a href="{{ sub.payment_image.url }}" target="_blank"
                                    class="text-primary hover:underline">Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„</a>
                                {% else %}
                                Ù„Ø§ ÙŠÙˆØ¬Ø¯
                                {% endif %}
                            </p>
                        </div>
                        {% endif %}
                        {% empty %}
                        <p class="text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø³Ø§Ø¨Ù‚Ø©.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        <!-- Footer -->
        <footer class="bg-white border-t py-4 text-center text-gray-500 text-sm">
            Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; Ù…Ù†ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… {{ year|default:'2025' }}
        </footer>

        <!-- JavaScript -->
        <script src="{% static 'js/student_dashboard.js' %}"></script>
        <!-- Modal --><!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        {% if not is_complete %}
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                Swal.fire({
                    title: "Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ",
                    html: `
            <form id="profileForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <label style="display:block; margin-top:10px; font-weight:bold;">Ø¥Ø¯Ø®Ø§Ù„ ØµÙˆØ±Ø© Ù„Ùƒ:</label>
                <input type="file" name="image" class="swal2-file">
                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ø§Ø³Ù…:</label>
                <input type="text" name="name" class="swal2-input" value="{{ request.user.name }}">

                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ø¹Ù…Ø±:</label>
                <input type="number" name="age" class="swal2-input" value="{{ student_data.age }}">

                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
                <input type="text" name="city" class="swal2-input" value="{{ student_data.city }}">

                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</label>
                <input type="text" name="level" class="swal2-input" value="{{ student_data.level }}">
                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                <input type="text" name="current_surah" class="swal2-input" value="{{ student_data.current_surah }}">

                <label style="display:block; margin-top:10px; font-weight:bold;">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                <input type="text" name="current_juz" class="swal2-input" value="{{ student_data.current_juz }}">
               
            </form>
        `,
                    confirmButtonText: "Ø­ÙØ¸",
                    allowOutsideClick: false,
                    preConfirm: () => {
                        let form = document.getElementById("profileForm");
                        let formData = new FormData(form);

                        return fetch("{% url 'update_profile' %}", {
                            method: "POST",
                            body: formData,
                            headers: {
                                "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value
                            }
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
                                }
                                return response.text();
                            })
                            .then(() => {
                                Swal.fire({
                                    icon: "success",
                                    title: "ØªÙ… Ø§Ù„Ø­ÙØ¸",
                                    text: "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­",
                                }).then(() => {
                                    location.reload();
                                });
                            })
                            .catch(error => {
                                Swal.showValidationMessage(error);
                            });
                    }
                });
            });
        </script>
        {% endif %}


</body>

</html>